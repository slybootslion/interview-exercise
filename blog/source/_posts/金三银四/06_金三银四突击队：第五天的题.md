---
title: "金三银四突击队：第五天的题"
date: 2021-02-25 18:22:41
tags:
  - 面试
  - 金三银四
---

<!--banner-pic|sticker|content-img|content-img-half-->

### 第一题

> 有没有写过Koa中间件，说下中间件原理，介绍下自己写过的中间件?

Koa提供use方法来加载中间件，它会将一个个函数包装成async并变成处理链，每个函数中，通过await next()来调用下一个函数。
Koa的中间件是用过async/await来实现的，中间件的执行顺序是洋葱模型。中间件之间通过next函数来联系，调用next来执行下一个函数，并在参数中传递ctx（上下文），函数一次传递直到不再执行next()就原路返回，并依次执行上一个函数中next()后方的代码。

在Koa的项目中，我主要写过全局异常处理中间件和jwt身份校验的中间件。
在注册全局异常处理中间件后，所有Koa的异常报错都会自动被中间件捕获，可以在函数中方便的处理手动抛出的异常，比如格式化返回给前端的信息，也可以返回更友好的服务器错误信息给客户端而不是直接抛出难以理解的错误。
在需要token校验的路由中，可以注册jwt身份校验的中间件，方便的判断用户是否有携带token，token是否过期，是否可以无感知刷新token，以及token如果有效，方便的将用户信息挂载到上下文中，方便后续业务逻辑处理。

### 第二题

> 如何判断当前脚本运行在浏览器还是node环境中？

判断全局对象来确实是否在浏览器或node环境中，比如：`typeof window` 如果是`undefined`，那一定不是浏览器环境。

### 第三题

> 请描述一下cookies，sessionStorage和localstorage区别？

都是保存在浏览器端的一种持久化策略，且都遵循同源策略。

不同点：
1. cookie一般由服务器生成，可设置失效时间，如果浏览器端生成，默认关闭浏览器后失效。loacalStorage由浏览器生成，存储在浏览器本地，除非手动清除，否则永久保存。sessionStorage仅在当前会话下有效，关闭页面或浏览器被清除。
2. 存储大小：cookie是4kb左右，loacalStorage和sessionStorage一般浏览器为5mb。
3. 在跟服务器通讯时，cookie会携带在http头中，而另外两个仅在浏览器中保存，不与服务器通讯。


